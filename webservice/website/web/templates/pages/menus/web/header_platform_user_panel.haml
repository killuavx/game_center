{% if request.user.is_authenticated %}
%dl.abs.dn.bdc.bg-white.zx2.f14
  %i.abs.ios-web-icon
  %dd.h24.lh24.pl10.pr10.pt5.pb5.red<
    你好，
    %a.red{:href => "#"}= request.user.username
    %a.ml10.log-out{:href => "{% url 'logout' %}"} [退出]
{% else %}
{% include "accounts/web/account_login_form.html" %}
:javascript
  function open_login(){
      $(".login-box").zxxbox({
          title: "会员登录",
          fix: true,
      });
  }
  function submit_login(form_dom){
    var form = $(form_dom);
    var vc_tips_cls = 'Validform_checktip';
    var validation_msg = form.find('.Validform_wrong');
    window.msg = validation_msg;
    $.ajax({
      url: form.attr('action'),
      type:'post',
      dataType:'json',
      data:form.serialize(),
      beforeSend:function(){
        validation_msg.removeClass(vc_tips_cls).text('');
      },
      success:function(data){
          console.log(data);
          if( data.code == 0 ){
              if(data.next){
                window.location = data.next;
              }
              else{
                window.location.reload();
              }
          }
          else
          {
              var tips = [];
              for(k in data.errors){
                 alert(k);
                 alert(data.errors[k]);
                 tips.push(data.errors[k].join(","));
                 break;
              }
              validation_msg.text(tips.join(',')).addClass(vc_tips_cls);
              refresh_captcha('.yzm-img');
          }
      }
    });
    return false;
  }
{% endif %}
